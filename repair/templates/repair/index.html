{% extends "repair/base.html" %}
{% load staticfiles %}

{% block top_menu %}
  {% include "includes/top_menu.html" %}
{% endblock %}


{% block sidebar_action %}
{% if not outsource %}
  {% include "includes/action_menu.html" with menu_set="1" %}
{% endif %}
{% endblock %}


{% block sub_header_progress_bar %}
  {% if messages %}
    {% for message in messages %}
      <p>
        <div class="alert alert alert-success alert-dismissable">
          <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
          {{ message }}
        </div>
      </p>
    {% endfor %}
  {% endif %}
  {% if not outsource %}
    <h2 class="sub-header">Все заказы</h2>
  {% else %}
    <h2 class="sub-header">Ваши заказы</h2>
  {% endif %}
<!--
  <div class="progress">
    <div class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar"
    aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width:40%">
      40% Завершено
    </div>
  </div>
-->
{% endblock %}


{% block table_main %}
  <div class="table-responsive">
    <table class="table table-hover table-striped" id="table">
      <thead>
        <th><span class="glyphicon glyphicon-barcode"></span></th>
        <th>Дата приемки</th>
        <th>Статус</th>
        {% if not outsource %}
        <th>Клиент</th>
        {% endif %}
        <th>Устройство</th>
        <th>Серийный номер</th>
        <th class="hidden-xs">Заявленная неисправность</th>
        <th>Мастер</th>
      </thead>
      <tfoot>
        <th></th>
        <th><input type="text" placeholder="Search"/></th>
        <th><input type="text" placeholder="Search"/></th>
        <th></th>
        <th></th>
        <th></th>
        <th></th>
        <th><input type="text" placeholder="Search"/></th>
      </tfoot>

      {% for order in orders %}
      <tr>
        <td><a href="{% url 'repair:order_detail' order_id=order.id %}">{{ order.order_barcode }}</a></td>
        <td>{{ order.order_datetime|date:"d.m.Y" }}</td>
          {% with order.last_status as last_act %}
            <td>{% include "includes/order_status.html" %}</td>
          {% endwith %}
          {%if not outsource %}
            <td>{{ order.client.client_name }}</td>
          {% endif %}
        <td>{{ order.device_name }}</td>
        <td>{{ order.device_serial }}</td>
        <td class="hidden-xs">{{ order.device_defect }}</td>
        <td>{{ order.last_action.executor_user.get_full_name }}</td>
      </tr>
      {% endfor %}
    </table>
  </div>
{% endblock %}


<--
{% block pagination %}
{% if orders.paginator.num_pages > 1 %}
<div class="text-center">
  <ul class="pagination text-center">
    {% if orders.has_previous %}
      <li><a href="{% url 'repair:index' %}?page={{ orders.previous_page_number }}">&laquo;</a></li>
    {% else %}
      <li class="disabled"><a href="#">&laquo;</a></li>
    {% endif %}
    {% for pn in orders.paginator.page_range %}
      {% if orders.number == pn %}
        <li class="active"><a href="{% url 'repair:index' %}?page={{ pn }}"> {{ pn }} <span class="sr-only">(current)</span></a></li>
      {% else %}
        <li><a href="{% url 'repair:index' %}?page={{ pn }}"> {{ pn }}</a></li>
      {% endif %}
    {% endfor %}
    {% if orders.has_next %}
      <li><a href="{% url 'repair:index' %}?page={{ orders.next_page_number }}">&raquo;</a></li>
    {% else %}
      <li class="disabled"><a href="#">&raquo;</a></li>
    {% endif %}
  </ul>
</div>
{% endif %}
{% endblock %}
-->

{% block script_block %}
  <link href="{% static 'repair/css/jquery.dataTables.min.css' %}" rel="stylesheet">
  <script type="text/javascript" src="{% static 'repair/js/tab_sort.js' %}"></script>
  <script type="text/javascript" src="{% static 'repair/js/jquery.dataTables.min.js' %}"></script>
{% endblock %}
